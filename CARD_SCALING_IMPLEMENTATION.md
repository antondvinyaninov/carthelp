# Реализация фиксированной карты с пропорциональным масштабированием

## Описание проблемы

Необходимо было создать карту экстренной помощи, которая:
- Всегда выглядит одинаково (как статичное изображение)
- Не адаптируется и не меняет внутреннюю структуру при изменении размера экрана
- Уменьшается пропорционально, если контейнер меньше базового размера (эффект "зажатого Shift")
- Никогда не растягивается больше базового размера

## Техническое решение

### 1. Фиксированные размеры всех элементов

Все элементы карты используют абсолютные размеры в пикселях:

**Размеры карты:**
- Ширина: `540px`
- Высота: `320px`
- Соотношение сторон: `1.6875:1` (приближено к стандарту кредитной карты)

**Размеры элементов:**
- Хедер: высота `40px`, шрифт `14px`
- Фото: `80px × 80px`
- ФИО: шрифт `22px`
- Заголовок контактов: шрифт `12px`
- Имя контакта: шрифт `13px`
- Телефон контакта: шрифт `15px`
- Футер: высота `44px`
- "112": шрифт `28px`

**Отступы:**
- Основной padding: `24px`
- Между элементами: `16px`, `8px`, `4px`, `2px`

### 2. CSS Transform Scale для масштабирования

Вместо изменения размеров элементов используется CSS-трансформация `transform: scale()`.

#### Расчет коэффициента масштабирования (JavaScript):

```javascript
const containerWidth = containerRef.current.offsetWidth
const cardWidth = 540
const scale = Math.min(1, containerWidth / cardWidth)
```

**Примеры:**
- Контейнер 270px → `scale = 0.5` (карта уменьшится в 2 раза)
- Контейнер 405px → `scale = 0.75` (карта уменьшится на 25%)
- Контейнер 540px → `scale = 1` (карта в полном размере)
- Контейнер 800px → `scale = 1` (карта НЕ увеличивается)

#### Реактивность:

```javascript
useEffect(() => {
  const updateScale = () => {
    if (containerRef.current) {
      const containerWidth = containerRef.current.offsetWidth
      const cardWidth = 540
      const newScale = Math.min(1, containerWidth / cardWidth)
      setScale(newScale)
    }
  }

  updateScale()
  window.addEventListener('resize', updateScale)
  return () => window.removeEventListener('resize', updateScale)
}, [])
```

### 3. Двухуровневая структура контейнеров

#### Внешний контейнер (резервирует место в layout):

```javascript
<div style={{ 
  width: '540px',
  height: `${320 * scale}px`,  // Динамическая высота
  maxWidth: '100%',
  margin: '0 auto',
  position: 'relative'
}}>
```

**Назначение:**
- Резервирует правильное пространство в DOM
- Предотвращает наложение следующих элементов
- Высота пропорциональна масштабу

**Примеры высоты:**
- `scale = 0.5` → высота = `160px`
- `scale = 0.75` → высота = `240px`
- `scale = 1` → высота = `320px`

#### Внутренний контейнер (масштабируется):

```javascript
<div style={{
  width: '540px',
  height: '320px',
  transform: `scale(${scale})`,
  transformOrigin: 'top center',
  position: 'absolute',
  top: 0,
  left: '50%',
  marginLeft: '-270px'
}}>
```

**Назначение:**
- Содержит карту фиксированного размера
- Применяет CSS-трансформацию для масштабирования
- Центрируется горизонтально

### 4. Центрирование карты

```javascript
position: 'absolute',
left: '50%',
marginLeft: '-270px'  // Половина ширины карты (540 / 2)
```

**Как работает:**
1. `left: '50%'` - сдвигает левый край карты к центру контейнера
2. `marginLeft: '-270px'` - сдвигает карту влево на половину её ширины
3. Результат: карта центрирована независимо от масштаба

### 5. Структура компонентов

#### CardPreview.tsx
Отвечает за:
- Расчет масштаба
- Создание контейнеров
- 3D-переворот карты
- Кнопку переворота

#### CardFrontSide.tsx
Содержит:
- Фиксированную структуру лицевой стороны
- Все элементы с абсолютными размерами
- Футер с абсолютным позиционированием внизу

```javascript
<div style={{ 
  width: '540px',
  height: '320px'
}}>
  {/* Хедер */}
  <div style={{ height: '40px' }}>...</div>
  
  {/* Контент */}
  <div style={{ padding: '20px 24px 0 24px' }}>
    {/* Фото + ФИО */}
    {/* Контакты */}
  </div>
  
  {/* Футер - абсолютное позиционирование */}
  <div style={{ 
    position: 'absolute',
    bottom: 0,
    left: 0,
    right: 0,
    height: '44px'
  }}>...</div>
</div>
```

## Преимущества решения

✅ **Консистентность**: Карта всегда выглядит одинаково
✅ **Предсказуемость**: Размеры не зависят от viewport или контейнера
✅ **Производительность**: CSS transform аппаратно ускоряется
✅ **Простота**: Не нужно вычислять размеры для каждого элемента
✅ **Масштабируемость**: Легко изменить базовый размер карты
✅ **Печать**: Карта готова для печати в фиксированном размере

## Альтернативные подходы (не использованы)

❌ **CSS clamp()**: Элементы адаптируются, но пропорции могут нарушаться
❌ **Viewport units (vw, vh)**: Размеры зависят от экрана, не фиксированные
❌ **Flexbox с flex-grow**: Элементы растягиваются непредсказуемо
❌ **Media queries**: Требуют множество брейкпоинтов, сложно поддерживать
❌ **SVG**: Сложность с текстом и интерактивностью

## Ключевые файлы

```
frontend/
├── components/
│   └── cards/
│       ├── CardPreview.tsx          # Логика масштабирования
│       ├── CardFrontSide.tsx        # Фиксированная структура лицевой стороны
│       ├── CardBackSide.tsx         # Фиксированная структура обратной стороны
│       └── front/
│           ├── CardHeader.tsx       # Хедер (40px)
│           ├── CardPhotoName.tsx    # Фото + ФИО
│           ├── CardEmergencyContacts.tsx  # Контакты
│           └── CardFooter.tsx       # Футер (44px)
```

## Использование

```tsx
<CardPreview 
  data={cardData} 
  cardSide={cardSide}
  onFlip={setCardSide}
/>
```

Компонент автоматически:
1. Отслеживает размер контейнера
2. Вычисляет масштаб
3. Применяет трансформацию
4. Резервирует правильное место в layout

## Результат

Карта работает как статичное изображение с эффектом "зажатого Shift":
- При ширине контейнера ≥ 540px: карта 540×320px
- При ширине контейнера < 540px: карта масштабируется пропорционально
- Все элементы сохраняют пропорции
- Карта всегда центрирована
- Следующий контент не налезает на карту

---

**Дата создания**: 22 февраля 2026  
**Автор**: Kiro AI Assistant  
**Версия**: 1.0
