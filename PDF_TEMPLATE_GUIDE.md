# Руководство по созданию PDF шаблонов

## Обзор

Система использует PDF шаблоны с полями форм для генерации карт помощи. Вы создаете дизайн в любом редакторе (Figma, Illustrator, InDesign), экспортируете в PDF, затем добавляете поля форм в Adobe Acrobat.

## Шаг 1: Создание дизайна

1. Создайте дизайн карты в Figma/Illustrator/InDesign
2. Размер: 540x320 пикселей (или 85.6mm x 54mm для печати)
3. Экспортируйте в PDF

## Шаг 2: Добавление полей в Adobe Acrobat

### Для лицевой стороны (card-front.pdf)

Откройте PDF в Adobe Acrobat Pro и добавьте текстовые поля:

**Основные данные:**
- `lastName` - Фамилия
- `firstName` - Имя
- `middleName` - Отчество

**Контакт 1:**
- `contact1Relationship` - Отношение (Жена, Муж, Мама и т.д.)
- `contact1Name` - Имя контакта
- `contact1Phone` - Телефон контакта

**Контакт 2:**
- `contact2Relationship` - Отношение
- `contact2Name` - Имя контакта
- `contact2Phone` - Телефон контакта

**Важно:** 
- Фото и QR код вставляются программно, поля для них не нужны
- Координаты фото: x=24, y=60, размер 100x100
- Координаты QR: x=24, y=282, размер 32x32

### Для обратной стороны (card-back.pdf)

**Медицинские данные:**
- `bloodType` - Группа крови с резус-фактором

**Аллергии (до 3-х):**
- `allergy1` - Первая аллергия
- `allergy2` - Вторая аллергия
- `allergy3` - Третья аллергия

**Хронические заболевания (до 3-х):**
- `disease1` - Первое заболевание
- `disease2` - Второе заболевание
- `disease3` - Третье заболевание

**Важно:**
- QR код карты вставляется программно
- Координаты QR: x=32, y=32, размер 96x96

## Шаг 3: Настройка полей

Для каждого поля в Adobe Acrobat:

1. Выберите инструмент "Prepare Form"
2. Добавьте текстовое поле
3. Задайте имя поля (точно как указано выше)
4. Настройте шрифт (рекомендуется Arial или другой с поддержкой кириллицы)
5. Настройте размер шрифта
6. Выровняйте текст по нужному краю

## Шаг 4: Сохранение

1. Сохраните PDF с полями
2. Поместите файлы в `backend/templates/`:
   - `card-front.pdf`
   - `card-back.pdf`

## Координаты в PDF

**Важно:** В PDF координаты идут снизу вверх (не как в SVG)!

Для карты 540x320:
- Верхний левый угол: (0, 320)
- Нижний левый угол: (0, 0)
- Верхний правый угол: (540, 320)
- Нижний правый угол: (540, 0)

## Настройка координат изображений

Если фото или QR коды вставляются не в том месте, отредактируйте координаты в `backend/utils/cardPdfGenerator.js`:

```javascript
// Для фото на лицевой стороне
const photoX = 24;
const photoY = firstPage.getHeight() - 160; // 160 = отступ_сверху + высота_фото

// Для QR на лицевой стороне
const qrX = 24;
const qrY = firstPage.getHeight() - 314; // 314 = отступ_сверху + размер_QR

// Для QR на обратной стороне
const qrX = 32;
const qrY = firstPage.getHeight() - 128;
```

## Тестирование

После создания шаблонов:

1. Перезапустите сервер
2. Создайте или откройте карту
3. Нажмите "Скачать PDF (обе стороны)"
4. Проверьте, что все поля заполнены правильно
5. Проверьте, что фото и QR коды на месте

## Альтернатива: Создание полей программно

Если у вас нет Adobe Acrobat Pro, можно создать простой PDF без полей, и система будет рисовать текст напрямую. Для этого нужно будет модифицировать `cardPdfGenerator.js` для использования `page.drawText()` вместо заполнения полей форм.

## Поддержка

Если возникли проблемы:
1. Проверьте имена полей (они должны точно совпадать)
2. Проверьте кодировку шрифтов (должна поддерживать кириллицу)
3. Проверьте координаты изображений
4. Посмотрите логи сервера для отладки
